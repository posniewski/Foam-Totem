{
    "content":"It's snowy on the Foam Totem!\n\n<script>\n(function() {\n  var requestAnimationFrame = window.requestAnimationFrame       ||\n                              window.webkitRequestAnimationFrame ||\n                              window.mozRequestAnimationFrame    ||\n                              function(func) { setTimeout(func, 17); };\n  var html = document.documentElement;\n  function Snowflake(maxX) {\n    this.reset(maxX);\n  }\n  Snowflake.prototype.tick = function() {\n    var sidePhase = this.sidePhase += this.sideVel;\n    this.y += this.vel;\n    this.x += this.sideVel;\n  };\n  Snowflake.prototype.reset = function(maxX) {\n    var rand = Math.random();\n    var chanceOfLargeSnowflake = 0.15;\n    this.size = 2 + Math.random() * 5;\n    this.vel = 2 + Math.random() * 2;\n    this.alpha = 0.5 + Math.random() * 0.8;\n    \/\/ random x position\n    this.x = Math.random() * maxX;\n    this.y = -this.size;\n    \/\/ side-to-side movement\n    this.sideVel = (0.35 - Math.random()) * this.vel;\n    return this;\n  };\n  (function() {\n    var canvas = document.createElement('canvas');\n    var context = canvas.getContext('2d');\n    var settleCanvas = document.createElement('canvas');\n    var settleContext = context && settleCanvas.getContext('2d');\n    var canvasStyle = canvas.style;\n    var settleCanvasStyle = settleCanvas.style;\n    var windowResized;\n    var activeFlakes = [];\n    var snowflakesPerPixelPerSecond = 0.05;\n    var PIx2 = Math.PI*2;\n    var assumedFps = 60;\n    var settlePoint;\n    var snowflakePool = [];\n    function resizeCanvas() {\n      settlePoint = Array(html.clientWidth);\n      settleCanvas.width = canvas.width = html.clientWidth;\n      settleCanvas.height = canvas.height = html.clientHeight;\n    }\n    function updateSettlePoints(flake) {\n      var size = flake.size * 0.8; \/\/ reduce coral effect\n      var xStart = Math.floor(flake.x - size);\n      var range = size * 2;\n      var newY;\n      if (0 > xStart) {\n        range += xStart;\n        xStart = 0;\n      }\n      if (xStart + range > settlePoint.length) {\n        range -= xStart + range - settlePoint.length;\n      }\n      for (var i = 0; range > i; i++) {\n        newY = flake.y - (size * Math.cos( (i\/range) * Math.PI - (Math.PI\/2) ));\n        settlePoint[i + xStart] = Math.min(settlePoint[i + xStart] || Infinity, newY);\n      }\n    }\n    var flakesToCreate = 0;\n    function frame() {\n      flakesToCreate += (snowflakesPerPixelPerSecond \/ assumedFps) * canvas.width;\n      var flakesThisFrame = Math.floor(flakesToCreate);\n      flakesToCreate -= flakesThisFrame;\n      \/\/ clear canvas\n      if (windowResized) {\n        resizeCanvas();\n        windowResized = false;\n      }\n      else {\n        context.clearRect(0, 0, canvas.width, canvas.height);\n      }\n      \/\/ add new flake?\n      while ( flakesThisFrame-- ) {\n        if (snowflakePool.length) {\n          activeFlakes.push( snowflakePool.pop().reset(canvas.width) );\n        }\n        else {\n          activeFlakes.push( new Snowflake(canvas.width) );\n        }\n      }\n      var i = activeFlakes.length;\n      var flake;\n      \/\/ for each flake...\n      while (i--) {\n        flake = activeFlakes[i];\n        flake.tick();\n        \/\/ splice flake if it's now out of rendering zone\n        if (flake.y >= canvas.height || flake.y >= settlePoint[Math.floor(flake.x)]) {\n          snowflakePool.push.apply(snowflakePool, activeFlakes.splice(i, 1));\n          \/\/ this flake effects our settle points\n          if (flake.alpha > 0.8) {\n            updateSettlePoints(flake);\n          }\n          settleContext.fillStyle='rgba(255, 255, 255, ' + flake.alpha + ')';\n          settleContext.beginPath();\n          settleContext.arc(flake.x, flake.y, flake.size, 0, PIx2, true);\n          settleContext.closePath();\n          settleContext.fill();\n          continue;\n        }\n        \/\/ render to canvas\n        context.fillStyle='rgba(255, 255, 255, ' + flake.alpha + ')';\n        context.beginPath();\n        context.arc(flake.x, flake.y, flake.size, 0, PIx2, true);\n        context.closePath();\n        context.fill();\n      }\n      requestAnimationFrame(frame);\n    }\n    if (context) {\n      resizeCanvas();\n      \/\/ style the canvas\n      canvasStyle.position = 'fixed';\n      canvasStyle.top = 0;\n      canvasStyle.left = 0;\n      canvasStyle.zIndex = 1138;\n      canvasStyle['pointerEvents'] = 'none';\n      settleCanvasStyle.cssText = canvasStyle.cssText;\n      \/\/ watch out for resizes\n      window.addEventListener('resize', function() {\n        windowResized = true;\n      }, false);\n      \/\/ add it to the page & start animating\n      document.body.appendChild(canvas);\n      document.body.appendChild(settleCanvas);\n      requestAnimationFrame(frame);\n    }\n  })();\n})();\n<\/script>",
    "description":"It's snowy on the Foam Totem!",
    "id":"20121219_9_204649",
    "link":"",
    "publishedDate":"2012-12-19T20:46:49+00:00",
    "source":"foamtotem",
    "title":"Let it Snow!",
    "via":"https:\/\/gist.github.com\/4338551"
}